import{_ as s,c as i,o as a,a3 as l}from"./chunks/framework.CBHj4tz5.js";const g=JSON.parse('{"title":"Python使用wkhtmltopdf 进行PDF的生成","description":"","frontmatter":{},"headers":[],"relativePath":"Python/htmltopdf.md","filePath":"Python/htmltopdf.md","lastUpdated":1732241785000}'),n={name:"Python/htmltopdf.md"},e=l(`<h1 id="python使用wkhtmltopdf-进行pdf的生成" tabindex="-1">Python使用wkhtmltopdf 进行PDF的生成 <a class="header-anchor" href="#python使用wkhtmltopdf-进行pdf的生成" aria-label="Permalink to &quot;Python使用wkhtmltopdf 进行PDF的生成&quot;">​</a></h1><hr><h4 id="概述" tabindex="-1">概述 <a class="header-anchor" href="#概述" aria-label="Permalink to &quot;概述&quot;">​</a></h4><p>本文简要介绍了 Python环境下如何进行HTML--&gt;PDF的转换，以及遇到的问题及解决方案</p><blockquote><p>摘自官网<img src="https://wkhtmltopdf.org/images/banner.jpg" alt="" loading="lazy"></p></blockquote><p>官方网站：<a href="https://wkhtmltopdf.org/" target="_blank" rel="noreferrer">点击跳转</a></p><p>Github：<a href="https://github.com/wkhtmltopdf/wkhtmltopdf" target="_blank" rel="noreferrer">点击跳转</a></p><h4 id="_1-功能优势" tabindex="-1">1.  功能优势 <a class="header-anchor" href="#_1-功能优势" aria-label="Permalink to &quot;1.  功能优势&quot;">​</a></h4><p>此方案是后端异步方案，相较于前端对用户体验更好，节省前端资源，使用 wkhtmltopdf 的最终目的是依赖其自身功能将HTML模板转换为PDF，转化步骤大体分为三部分：</p><ul><li>后端查询出要展示的报告数据并写入前端可用的JavaScript文件中</li><li>绘制报告样式模板及其数据引用</li><li>后端通过工具将渲染好的HTML模板转化为PDF文件</li></ul><h4 id="_2-转化过程遇到的问题" tabindex="-1">2.  转化过程遇到的问题 <a class="header-anchor" href="#_2-转化过程遇到的问题" aria-label="Permalink to &quot;2.  转化过程遇到的问题&quot;">​</a></h4><ul><li>设置强制分页问题，该属性同样适用于需要强制分页的模块 <ul><li>例如echarts图表当前页展示不下，默认会分割，导致图表分布在两页，显示不完整</li></ul></li></ul><div class="language-css vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">css</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">div</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    page-break-inside</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">avoid</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> !important</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li>表格分页时禁止表头与内容重叠</li></ul><div class="language-css vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">css</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">tr</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    page-break-before</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">always</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    page-break-after</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">always</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    page-break-inside</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">avoid</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li>charts图表不渲染 <ul><li>避免使用动画  增加属性 animation: false</li><li>wkhtmltopdf配置增加 javascript-delay：10000  （适当增加时间）</li></ul></li><li>导出PDF空白 <ul><li>避免使用ES6、CSS3等较新的语法和属性，例如对flex支持性为0</li></ul></li><li>导出PDF，图表不清晰，二种解决方案 <ul><li>渲染图表的时候可以选择SVG渲染，更加轻量和清晰，但是支持性不够，故采用第二条方案</li><li>导出配置参数提高PDF分辨率（dpi）,例如：</li></ul></li></ul><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 启动参数</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">wkhtmltopdf_options </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;enable-local-file-access&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;--enable-local-file-access&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;encoding&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;utf-8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;javascript-delay&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;10000&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;header-left&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;视频监控系统安全评估报告-[date] [time]&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;header-font-size&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">8</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;header-spacing&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;footer-center&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;第[page] / [topage]页&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;footer-font-size&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">8</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;margin-top&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;dpi&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">300</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h4 id="_4-关于html模板" tabindex="-1">4.  关于HTML模板 <a class="header-anchor" href="#_4-关于html模板" aria-label="Permalink to &quot;4.  关于HTML模板&quot;">​</a></h4><p>对于HTML模板的绘制，只要能确保最终渲染的页面能被工具识别到即可，这里分别列举了几种预设方案</p><ul><li>原生html+JavaScript+css，可适当引入js文件，例如jquery等依赖库简化开发</li><li>vue框架 <ul><li>vue2.x版本（这里实验了version@2.7.15），可以正常使用</li><li>vue3.x版本（这里实验了version@3.2.47），由于vue3对于响应式的原理实现有了变更，故导致转过化成并不顺利</li><li>所能配套使用的UI库试验了对应版本的element-ui和element-plus，由于UI库用了大量的较新语法，所以只支持较为简单的组件，且样式渲染度不完善，故不建议使用</li><li>预期通过babel-polyfill等垫片将其转化低阶语法可以使用上述2，3条</li></ul></li></ul><p>最终确定方案：</p><ol><li>引入框架vue@2.7.15，简化JavaScript开发；</li><li>JavaScript开发和CSS样式使用低阶语法；</li><li>表格采用原生table绘制</li><li>图表采用echarts</li></ol><h4 id="_5-附件" tabindex="-1">5. 附件 <a class="header-anchor" href="#_5-附件" aria-label="Permalink to &quot;5. 附件&quot;">​</a></h4><p>使用示例<br><a href="https://github.com/Aliuyanfeng/wkhtmltopdf-example.git" target="_blank" rel="noreferrer">https://github.com/Aliuyanfeng/wkhtmltopdf-example.git</a></p>`,24),t=[e];function p(h,k,r,d,E,o){return a(),i("div",null,t)}const u=s(n,[["render",p]]);export{g as __pageData,u as default};
